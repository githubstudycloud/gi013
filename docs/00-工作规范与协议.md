# Z Code Claude Code 工作规范与协议

## 1. 概述

本文档定义了 Z Code 环境下的 Claude Code (GLM-4.7) 的工作规范，确保每个会话的完整可追溯性。

## 2. 核心原则

### 2.1 完整性
- 记录每次用户提问
- 记录每次产出
- 记录每次提交的 Git 版本

### 2.2 可追溯性
- 每个 Q&A 都关联具体的 Git Commit
- 每个 Commit 都可追溯到具体的用户需求

### 2.3 持久性
- Q&A 记录随代码一起提交到 Git
- 新会话可查看历史记录

## 3. 工作流程

### 3.1 标准工作流
```
用户提问 → 执行任务 → 记录产出 → 提交推送 → 更新 Q&A → 再次提交
```

### 3.2 详细步骤

#### Step 1: 接收用户提问
- 理解用户需求
- 确认任务范围

#### Step 2: 执行任务
- 创建/修改文件
- 使用 Context7 查询文档
- 使用其他工具

#### Step 3: 产出总结
列出所有产出的文件和内容：
- 创建的文档
- 修改的代码
- 配置文件

#### Step 4: Git 提交推送
```bash
git add .
git commit -m "描述信息"
git push
```

#### Step 5: 更新 Q&A.md
在 Q&A.md 中添加记录：
```markdown
### Q{N}: {问题标题}
**提问**: {用户原始问题}
**时间**: {YYYY-MM-DD HH:MM}

**产出**:
- 创建了 {文件1}
- 修改了 {文件2}
- ...

**提交记录**:
- Commit: {commit-hash}
- Message: {commit-message}
- 时间: {YYYY-MM-DD HH:MM:SS}

**总结**:
{对产出的简要说明}
---
```

#### Step 6: 再次提交推送
```bash
git add docs/Q&A.md
git commit -m "update-qa"
git push
```

## 4. Q&A 记录格式

### 4.1 日期分组
```markdown
## YYYY-MM-DD

### Q{N}: {问题标题}
...
```

### 4.2 完整记录示例
```markdown
### Q12: 基础设施层设计
**提问**: 设计基础设施层文档
**时间**: 2026-01-13 11:30

**产出**:
- docs/02-基础设施层设计.md (新建)
  - platform-parent 父 POM 配置
  - platform-config 配置中心
  - platform-registry 服务注册
  - platform-common 公共组件

**提交记录**:
- Commit: 18ee6ba
- Message: add-infra-doc
- 时间: 2026-01-13 11:35:12
- URL: https://github.com/githubstudycloud/gi013/commit/18ee6ba

**总结**:
完成了基础设施层详细设计，包含 Maven 父 POM、配置中心、服务注册和公共组件的完整实现方案。

---
```

## 5. Git 提交规范

### 5.1 Commit Message 格式
```
<type>-<brief-description>
```

### 5.2 Type 类型
- `add`: 新增文件/功能
- `update`: 更新文件
- `fix`: 修复问题
- `docs`: 文档更新
- `refactor`: 重构

### 5.3 示例
```bash
git commit -m "add-infra-doc"        # 新增基础设施文档
git commit -m "update-qa"            # 更新 Q&A
git commit -m "fix-config"           # 修复配置
git commit -m "add-gateway"          # 新增网关
```

### 5.4 获取 Commit 信息
```bash
# 获取最新 commit hash
git rev-parse HEAD

# 获取完整 commit 信息
git log -1 --pretty=format:"%H|%s|%ai"

# 获取 GitHub URL
git remote get-url origin
```

## 6. 自动化脚本

### 6.1 自动提交脚本
创建 `scripts/commit-with-qa.sh`:
```bash
#!/bin/bash
# 自动提交并记录 Q&A

# Step 1: 提交代码
echo "提交代码..."
git add .
COMMIT_MSG=$1
git commit -m "$COMMIT_MSG"

# Step 2: 获取 commit 信息
COMMIT_HASH=$(git rev-parse HEAD)
COMMIT_TIME=$(git log -1 --pretty=format:"%ai" $COMMIT_HASH)

# Step 3: 推送
echo "推送到远程..."
git push

# 输出 commit 信息
echo "Commit: $COMMIT_HASH"
echo "Time: $COMMIT_TIME"
```

### 6.2 使用方法
```bash
bash scripts/commit-with-qa.sh "add-docs"
```

## 7. 新会话启动流程

### 7.1 新会话初始化
当用户在新会话中提问时，Claude Code 应该：

1. **读取 Q&A.md**
   ```bash
   查看历史记录
   ```

2. **获取最新状态**
   ```bash
   git log -1
   ```

3. **继续记录**
   - 使用下一个序号的 Q{N}
   - 继续添加到当天日期分组

### 7.2 示例
```markdown
## 2026-01-13

### Q12: {旧问题}
...

### Q13: {新会话的新问题}
**提问**: ...
**时间**: 2026-01-13 14:00
...
```

## 8. 持续配置

### 8.1 无需修改配置文件
Z Code 的 Claude Code 无需修改配置文件，只需：
1. 遵循本规范文档
2. 每次提问后自动执行流程
3. 保持 Q&A.md 更新

### 8.2 规范文档位置
```
docs/
├── 00-工作规范与协议.md    # 本文档
├── 01-总体架构设计.md
├── 02-基础设施层设计.md
└── Q&A.md                 # Q&A 记录
```

## 9. 质量保证

### 9.1 检查清单
每次提交前确认：
- [ ] 所有文件已添加到 Git
- [ ] Commit message 清晰准确
- [ ] Q&A.md 已更新
- [ ] 包含 commit hash 和时间
- [ ] 产出总结完整

### 9.2 常见错误
❌ **错误**: 忘记更新 Q&A.md
✅ **正确**: 每次提交后都更新 Q&A

❌ **错误**: 没有记录 commit hash
✅ **正确**: 记录完整的 commit 信息

❌ **错误**: 产出总结不清晰
✅ **正确**: 列出所有产出的文件和内容

## 10. 示例完整流程

### 场景：用户要求创建新文档

#### 1. 用户提问
```
创建平台服务层设计文档
```

#### 2. Claude 执行
```
- 创建 docs/03-平台服务层设计.md
- 编写内容
- 提交代码
```

#### 3. 获取提交信息
```bash
git log -1
# Commit: abc123def
# Time: 2026-01-13 14:30:00
```

#### 4. 更新 Q&A.md
```markdown
### Q13: 平台服务层设计
**提问**: 创建平台服务层设计文档
**时间**: 2026-01-13 14:20

**产出**:
- docs/03-平台服务层设计.md (新建)
  - platform-gateway 网关设计
  - platform-admin 管理平台
  - platform-scheduler 定时任务
  - platform-status 状态页面

**提交记录**:
- Commit: abc123def
- Message: add-service-layer-doc
- 时间: 2026-01-13 14:30:00
- URL: https://github.com/githubstudycloud/gi013/commit/abc123def

**总结**:
完成了平台服务层详细设计，包含网关、管理平台、定时任务和状态页面的完整实现方案。

---
```

#### 5. 再次提交
```bash
git add docs/Q&A.md
git commit -m "update-qa"
git push
```

## 11. 工具支持

### 11.1 获取 Git 信息的脚本
创建 `scripts/git-info.sh`:
```bash
#!/bin/bash
echo "=== Git 信息 ==="
echo "最新 Commit:"
git log -1 --pretty=format:"Hash: %H%nMessage: %s%nTime: %ai%nAuthor: %an"
echo ""
echo "远程仓库:"
git remote get-url origin
echo ""
echo "分支:"
git branch --show-current
```

## 12. 总结

本规范确保：
1. ✅ 每次用户提问都有记录
2. ✅ 每次产出都有文档
3. ✅ 每次提交都可追溯
4. ✅ 新会话可无缝衔接
5. ✅ 历史记录完整保留

---

**文档版本**: v1.0
**创建日期**: 2026-01-13
**适用环境**: Z Code + Claude Code + GLM-4.7
**状态**: 已生效
